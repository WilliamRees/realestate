window.re={},re.views={},re.views.shared={},re.views.secure={},re.api={},re.utilities={},re.global=function(){var e=function(){re.api.dataApi.init(),"undefined"!=typeof Ladda&&Ladda.bind("input[type=submit]")};return{init:e}}(jQuery),$(function(){re.global.init()}),re.views.shared.forms=function(e){var t=function(t){n(),t=void 0===t?{}:t,e("form").validate(t),i()},i=function(){e('form input[type="submit"]').on("click",function(){})},n=function(){e.validator.setDefaults({highlight:function(t){e(t).closest(".form-group").addClass("has-error")},unhighlight:function(t){e(t).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){e.insertAfter(t.parent(".input-group").length?t.parent():t)}})};return{init:t}}(jQuery),re.views.secure.login=function(e){var t=function(e,t){var i=document.createElement("input");e.appendChild(i),i.name="p",i.type="hidden",i.value=hex_sha512(t.value),t.value=""},i=function(){re.views.shared.forms.init(),n()},n=function(){e("#LoginForm").on("submit",function(i){var n=e(this),r=n.valid();r&&(i.preventDefault(),t(n[0],n[0].password),n[0].submit())})};return{formhash:t,init:i}}(jQuery),re.views.secure.users=function(e){var t=function(e){function t(){e("#RegisterForm").on("submit",function(t){var n=e(this),r=n.valid();r&&(t.preventDefault(),i(n[0],n[0].username,n[0].email,n[0].password,n[0].confirmpwd),n[0].submit())})}function i(e,t,i,n,r){var o=document.createElement("input");return e.appendChild(o),o.name="p",o.type="hidden",o.value=hex_sha512(n.value),n.value="",r.value="",e.submit(),!0}var n=function(){var e={rules:{password:"required",confirmpwd:{equalTo:"#password"}}};re.views.shared.forms.init(e),t()};return{init:n}}(e);return{register:t}}(jQuery),re.notification=function(e){var t=function(t,n,r,o,a){$notification=e(t),$alert=$notification.find(".alert"),$alert.addClass(r),$alert.empty().html(n),$notification.show(),a&&e("html,body").animate({scrollTop:0},1),o&&setTimeout(function(){i(t)},5e3)},i=function(t){$notification=e(t),$notification.fadeOut("slow")};return{show:t}}(jQuery),re.utilities=function(e){function t(t,i){var r=e.extend(n,i);r.clearOnSubmit&&($form=e("#"+r.formId),$form.trigger("reset"))}function i(){}var n={clearOnSubmit:!1,formId:null},r=function(t){var n=e.Deferred();return e.ajax({type:"GET",url:t,cache:!1,success:function(e){e.Success?n.resolve(e):n.reject(e.Errors)},error:function(){i()}}),n.promise()},o=function(n,r,o){var a=e.Deferred();return e.ajax({type:"POST",url:n,cache:!1,data:r,success:function(e){e.Success?(t(e,o),a.resolve(e)):a.reject(e.Errors)},error:function(){i()}}),a.promise()},a=function(n,r,o){var a=e.Deferred();return e.ajax({type:"PUT",url:n,cache:!1,data:r,success:function(e){e.Success?(t(e,o),a.resolve(e)):a.reject(e.Errors)},error:function(){i()}}),a.promise()},s=function(t,n){var r=e.Deferred();return e.ajax({type:"DELETE",url:t,data:n,success:function(e){e.Success?r.resolve(e):r.reject(e.Errors)},error:function(){i()}}),r.promise()};return{post:o,"delete":s,get:r,put:a}}(jQuery),re.api.cms=function(){var e=SITE_ROOT+"secure/cms",t=function(t){return re.utilities.post(e+"/update.php",t)};return{update:t}}(jQuery),re.api.listing=function(){var e=SITE_ROOT+"api/listing/",t=function(t,i,n){var r="index.php";return r=void 0!==t&&null!==t?e+"?Id="+t:void 0!==i&&null!==i&&void 0!==n&&null!==n?e+"?page={0}&pagesize={1}".replace("{0}",i).replace("{1}",n):e,re.utilities.get(r)},i=function(t,i){return re.utilities.post(e+"index.php",t,i)},n=function(t,i){return re.utilities.put(e+"index.php",t,i)},r=function(t){return re.utilities.delete(e+"index.php",{Id:t})},o=function(t,i,n){var r=e+"statuses.php?status={0}&value={1}&id={2}";return r=r.replace("{0}",t),r=r.replace("{1}",i),r=r.replace("{2}",n),re.utilities.get(r)},a=function(t,i){i=void 0===i?!1:i;var n=e+"searchByAddress.php?SearchText="+t+"&ShowAddressOnly="+i;return re.utilities.get(n)},s={uri:SITE_ROOT+"api/listing/images.php",remove:function(e,t){var i={Id:e,FileName:t};return re.utilities.delete(this.uri,i)}};return{remove:r,search:a,statuses:o,get:t,add:i,update:n,image:s}}(jQuery),re.api.dataApi=function(e){var t=function(){n.init(),n.image.init()},i=e(document),n={init:function(){i.on("click","*[data-listing-remove]",function(t){t.preventDefault(),$this=e(this),re.api.listing.remove($this.data("listing-remove")).done(function(){$this.trigger("listing.removed")}).fail(function(){$this.trigger("listing.removed.error")})})},image:{init:function(){i.on("click","*[data-listing-image-remove]",function(t){t.preventDefault(),$this=e(this),re.api.listing.image.remove($this.data("listing-id"),$this.data("listing-image-remove")).done(function(){e($this.data("listing-image-remove-target")).remove()})})}}};return{init:t}}(jQuery),re.views.secure.cms=function(e){var t,i={ui:{toolbar:{items:["insert","style","emphasis",{label:"Indent Group",items:["indent","outdent"]},{label:"Custom Toolbar Group",items:["removeformat","fullscreen"]}]}}},n=function(){for(var i=0;i<t.length;i++){var n=t[i],r=e(".cms-content").eq(i).data("nodename"),o=n.content.get();re.api.cms.update({Name:r,Data:o})}},r=function(){e(function(){t=textboxio.inlineAll(".cms-content",i),o()})},o=function(){e("#SaveContentChanges").on("click",function(e){e.preventDefault(),n()})};return{init:r}}(jQuery),re.views.secure.listing=function(e){var t={getFormValues:function(){var t={Address:e("#Address").val(),City:e("#City").val(),Province:e("#Province").val(),Description:e("#Description").val(),Price:e("#Price").val(),PropertyType:e("#PropertyType").val(),Bedrooms:e("#Bedrooms").val(),Bathrooms:e("#Bathrooms").val(),LivingSpace:e("#LivingSpace").val(),LandSize:e("#LandSize").val(),TaxYear:e("#TaxYear").val(),Taxes:e("#Taxes").val(),BuildingAge:e("#BuildingAge").val(),Id:e("#ListingId").val()};return console.log(t),t},dropzone:{removedFile:function(e){var t;return null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0},accept:function(e,t){t()},toggleUploadBtns:function(){},init:function(){var i=e.Deferred();return Dropzone.autoDiscover=!1,e(function(){re.views.shared.forms.init();var e=document.querySelector("#template");e.id="";var n=e.innerHTML;e.parentNode.removeChild(e);var r=new Dropzone("div#NewListingDropZone",{url:SITE_ROOT+"/api/listing/images.php",paramName:"file",addRemoveLinks:!1,accept:t.dropzone.accept,acceptedFiles:"image/*",maxFilesize:2,autoProcessQueue:!1,removedfile:t.dropzone.removedFile,thumbnailWidth:80,thumbnailHeight:80,previewTemplate:n,previewsContainer:"#Dropzone-Preview",clickable:"*[dz-clickable]",dictDefaultMessage:""});i.resolve(r)}),i.promise()},prossesDropzone:function(e,t){e.getAcceptedFiles().length>0&&(e.on("sending",function(e,i,n){n.append("ListingId",t)}),e.options.autoProcessQueue=!0,e.processQueue())},bindEvents:function(t){t.on("totaluploadprogress",function(){}),t.on("queuecomplete",function(){t.options.autoProcessQueue=!1}),t.on("addedfile",function(){t.files.length>0&&e("#Dropzone-DefaultText").hide()}),t.on("removedfile",function(){0===t.files.length&&e("#Dropzone-DefaultText").show()})}}},i=function(){e("img.lazy").lazyload({threshold:200}),e("*[data-listing-remove]").on("listing.removed",function(){$this=e(this),$this.parents(".thumbnail").parent().remove()})},n=function(){e(function(){re.views.shared.forms.init(),i(),re.api.listing.search("",!0).done(function(t){e("#ListingSearchInput").typeahead({order:"desc",minLength:1,maxItem:50,selector:{filter:"input-group-btn",filterButton:"btn btn-default",dropdown:"dropdown-menu dropdown-menu-right",list:"dropdown-menu",hint:"form-control"},source:{data:t.Data},callback:{onInit:function(){},onClick:function(t,i,n){n.display.length>0&&e(t).parents("form").submit()}}})}),e("#ListingSearchForm").on("submit",function(t){if(t.preventDefault(),e(this).valid()){var i=e("#ListingSearchInput").val();e(".thumbnail").each(function(){var t=e(this);t.data("address").indexOf(i)>-1?t.parent().show():t.parent().hide()})}}),e("#PublishedFilter").on("change",function(){var t=this.options[this.selectedIndex].value;e("#ListingSearchInput").val(""),e(".thumbnail").each(function(){var i=e(this);i.find("#Published").prop("checked")&&"published"===t?i.parent().show():i.find("#Published").prop("checked")||"unpublished"!==t?"all"===t?i.parent().show():i.parent().hide():i.parent().show()})}),e('#StatusForms form input[type="checkbox"]').on("change",function(){var t=e(this),i=t.parents("form"),n=i.find('input[name="status"]').val(),r=i.find('input[name="id"]').val(),o=t.prop("checked")?1:0;if("published"===n&&1===o){t.prop("checked",!1);{var a=re.api.listing.get(r),s=a.then(function(t){var i=e.Deferred();if(t.Success){var n=t.Data,r=[];for(var o in n)n.hasOwnProperty(o)&&("[object Array]"===Object.prototype.toString.call(n[o])?0===n[o].length&&r.push(o):(null===n[o]||0===n[o].length)&&r.push(o));r.length>0?i.reject(r):i.resolve()}else i.reject();return i.promise()});s.fail(function(i){var a=e.Deferred();if(i.length>0){var s=e("#PublishConfirmation"),u="";i.forEach(function(e){u+="<li>"+e+"</li>"}),s.find("ul").html(u),s.modal({show:!0}),s.find(".btn-primary").on("click",function(){s.modal("hide"),re.api.listing.statuses(n,o,r),t.prop("checked",!0)})}return a.promise()}).done(function(){re.api.listing.statuses(n,o,r)})}}else re.api.listing.statuses(n,o,r)})})},r=function(e){function i(){t.dropzone.bindEvents(a),document.querySelector("#Submit").onclick=function(i){if(i.preventDefault(),e("#NewListing").valid()){var n=Ladda.create(this);n.start(),re.api.listing.add(t.getFormValues()).done(function(i){i.Success&&(a.files.length>0?(a.on("error",function(){alert("error"),s="error",a.off("error")}),t.dropzone.prossesDropzone(a,i.Data.Id),a.on("queuecomplete",function(){setTimeout(function(){n.stop(),"error"!==s&&(e("#NewListing").trigger("reset"),a.removeAllFiles()),re.notification.show("#Notification","<strong>Success!</strong> "+i.Data.Address+" was updated","alert-success",!0,!1)},500)})):setTimeout(function(){n.stop(),e("#NewListing").trigger("reset"),re.notification.show("#Notification","<strong>Success!</strong> "+i.Data.Address+" was updated","alert-success",!0,!1)},500))})}},document.querySelector("#Dropzone-Actions .cancel").onclick=function(){a.removeAllFiles(!0)},e(document).on("click",".delete",function(){var t=e(this),i=t.parents(".file-row").find("*[data-dz-name]").text();e.ajax({url:"index.php",type:"DELETE",data:{FileName:i},success:function(){o()}})})}function n(e){var t;return null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0}function r(e,t){t(),o()}function o(){a.getAcceptedFiles().length>0?(e("#actions .start").show(),e("#actions .cancel").show()):(e("#actions .start").hide(),e("#actions .cancel").hide())}var a,s,u=function(){Dropzone.autoDiscover=!1,e(function(){re.views.shared.forms.init();var e=document.querySelector("#template");e.id="";var t=e.innerHTML;e.parentNode.removeChild(e),a=new Dropzone("div#NewListingDropZone",{url:"http://172.16.158.129/VMLamp/real-estate/api/listing/images.php",paramName:"file",addRemoveLinks:!1,accept:r,acceptedFiles:"image/*",maxFilesize:2,autoProcessQueue:!1,removedfile:n,thumbnailWidth:80,thumbnailHeight:80,previewTemplate:t,previewsContainer:"#Dropzone-Preview",clickable:"*[dz-clickable]",dictDefaultMessage:""}),i()})};return{init:u}}(e),o=function(e){function i(){t.dropzone.bindEvents(n),document.querySelector("#Submit").onclick=function(i){if(i.preventDefault(),e("#EditListingForm").valid()){var o=Ladda.create(this);o.start(),re.api.listing.update(t.getFormValues()).done(function(e){e.Success&&(n.files.length>0?(n.on("error",function(){r="error",n.off("error")}),t.dropzone.prossesDropzone(n,e.Data.Id),n.on("queuecomplete",function(){setTimeout(function(){o.stop(),"error"!==r&&n.removeAllFiles(),re.notification.show("#Notification","<strong>Success!</strong> "+e.Data.Address+" was created","alert-success",!1)},500)})):setTimeout(function(){o.stop(),re.notification.show("#Notification","<strong>Success!</strong> "+e.Data.Address+" was created","alert-success",!1)},500))})}},n.on("success",function(t){console.log(t);var i=t.name,r=e(".listing-image").last().clone();r.attr("id",parseInt(r.attr("id"))+1),r.find("img").attr("src",SITE_ROOT+"/uploads/"+i),r.find(".name").html(i),$button=r.find("button"),$button.attr("data-listing-image-remove-target","#"+(parseInt(r.attr("id"))+1)),$button.attr("data-listing-image-remove",i),e(".listing-image").last().after(r),n.removeFile(t)})}var n,r,o=function(){n=t.dropzone.init().done(function(e){n=e,i()})};return{init:o}}(e);return{init:n,newlisting:r,editlisting:o}}(jQuery);